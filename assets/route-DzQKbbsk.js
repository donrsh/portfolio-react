import{R as S,r as c,j as i}from"./jsx-runtime-JVR6BLX4.js";import{c as j}from"./createSub-CFYt2xaS.js";import{c as K,u as b}from"./with-selector-DyLZNxmq.js";const{useDebugValue:C}=S,{useSyncExternalStoreWithSelector:F}=b,V=e=>e;function M(e,t=V,o){const s=F(e.subscribe,e.getState,e.getServerState||e.getInitialState,t,o);return C(s),s}const g=(e,t)=>{const o=K(e),s=(r,n=t)=>M(o,r,n);return Object.assign(s,o),s},k=(e,t)=>e?g(e,t):g;function O(e,t){if(Object.is(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;if(e instanceof Map&&t instanceof Map){if(e.size!==t.size)return!1;for(const[s,r]of e)if(!Object.is(r,t.get(s)))return!1;return!0}if(e instanceof Set&&t instanceof Set){if(e.size!==t.size)return!1;for(const s of e)if(!t.has(s))return!1;return!0}const o=Object.keys(e);if(o.length!==Object.keys(t).length)return!1;for(const s of o)if(!Object.prototype.hasOwnProperty.call(t,s)||!Object.is(e[s],t[s]))return!1;return!0}const w="data-auto-focus-item-when-scrolling",E=c.createContext(null),q=()=>c.useContext(E),x=k((e,t,o)=>({set:e,scrollContainer:null,scrollContainerRef(s){e({scrollContainer:s})},scrollContainerObserver:null,scrollingDirection:null,itemElKeyMap:new WeakMap,inViewItemEls:new Set,inViewItemKeys:new Set,setInViewItemEls(s,r){const{inViewItemEls:n,itemElKeyMap:u}=t();s.forEach(m=>n.add(m)),r.forEach(m=>n.delete(m));const a=new Set(n),l=new Set([...a].map(m=>u.get(m)??null));l.delete(null),e({inViewItemEls:new Set(n),inViewItemKeys:l})},focusItemEl:null,focusItemKey:null,updateFocus(){const{inViewItemEls:s,scrollContainer:r,scrollingDirection:n,focusItemEl:u,itemElKeyMap:a}=t();if(s.has(u))return;let l=[...(r==null?void 0:r.querySelectorAll(`[${w}]`))??[]];n==="upward"&&l.reverse();const m=l.find(d=>s.has(d))??null,I=a.get(m)??null;e({focusItemEl:m,focusItemKey:I})},useItem(s){const r=c.useRef(),[n,u,a,l]=q()(d=>[d.focusItemEl,d.set,d.scrollContainerObserver,d.itemElKeyMap]);c.useEffect(()=>{r.current&&a&&(r.current.setAttribute(w,""),a==null||a.observe(r.current))},[a]),c.useEffect(()=>{if(!["string","number"].includes(typeof s)){console.error("[useItem] item key should be string or number. Please check.");return}r.current&&l.set(r.current,s)},[s]);const m=n===r.current,I=c.useCallback(()=>{u({focusItemEl:r.current})},[u]);return c.useMemo(()=>({ref:r,isFocus:m,focus:I}),[r,m])}}),O),f=x,R=({children:e})=>{const[t,o,s,r]=f(n=>[n.scrollContainer,n.setInViewItemEls,n.updateFocus,n.set]);return c.useEffect(()=>{if(!t)return;const n=new IntersectionObserver((u,a)=>{o(u.filter(l=>l.isIntersecting).map(l=>l.target),u.filter(l=>!l.isIntersecting).map(l=>l.target))},{root:t,threshold:1});return r({scrollContainerObserver:n}),()=>{n.disconnect()}},[t,o,r]),c.useEffect(()=>{if(!t)return;const n=u=>{const a=u.deltaY>0?"downward":"upward";r({scrollingDirection:a}),s()};return t.addEventListener("wheel",n),()=>t.removeEventListener("wheel",n)},[t,r,s]),i.jsx(E.Provider,{value:x,children:e})},v=e=>({id:e,title:`Item ${e+1}`,text:[e%4>=0&&"Lorem ipsum dolor sit amet consectetur adipisicing elit.",e%4>=1&&"Minus quidem,",e%4>=2&&"reprehenderit aliquid iure esse quibusdam perspiciatis modi doloremque nobis at voluptatem repellat dignissimos nihil enim aspernatur eos?",e%4>=3&&"Fuga, accusantium incidunt."].filter(Boolean).join(" ")});let h=new Array(20).fill(null).map((e,t)=>v(t));const y=e=>h.find(t=>t.id===e)??null,p=j({Status:()=>{const[e,t,o]=f(n=>[n.scrollingDirection,n.inViewItemKeys,n.focusItemKey]),s=c.useMemo(()=>t?[...t].map(y):[],[t]),r=c.useMemo(()=>y(o),[o]);return i.jsxs("div",{style:{marginBottom:20},children:[i.jsxs("code",{children:[i.jsx("b",{children:"scrolling direction"}),":"," ",e==="downward"?"⬇️":e==="upward"?"⬆️":"null"]}),i.jsx("br",{}),i.jsxs("code",{children:[i.jsx("b",{children:"items in view"}),": ",s.map(n=>n==null?void 0:n.title).join(", ")]}),i.jsx("br",{}),i.jsxs("code",{children:[i.jsx("b",{children:"focus item"}),": ",r==null?void 0:r.title]})]})},Item:({id:e,title:t,text:o})=>{const{ref:s,isFocus:r,focus:n}=f(u=>u.useItem(e));return i.jsx("div",{ref:s,style:{borderBottom:"1px solid gray",paddingInline:8,cursor:"pointer"},onClick:n,children:i.jsx("div",{style:{opacity:r?1:.4},children:i.jsx("p",{children:i.jsx("b",{children:t})})})})},Items:()=>{const e=f(s=>s.scrollContainerRef),[,t]=c.useReducer(s=>s+1,0),o=c.useCallback(()=>{h[h.length]=v(h.length),t()},[]);return i.jsxs("div",{ref:e,style:{background:"lightgray",height:"100%",overflow:"auto",flex:"0 0 150px"},children:[h.map(s=>i.jsx(p.Item,{...s},s.id)),i.jsx("div",{children:i.jsx("button",{onClick:o,children:"Add an item"})}),i.jsx("div",{style:{height:"100%"}})]})},FocusItem:()=>{const e=f(o=>o.focusItemKey),t=c.useMemo(()=>y(e),[e]);return t&&i.jsx("div",{children:i.jsxs("div",{children:[i.jsx("p",{children:i.jsx("b",{children:t.title})}),i.jsx("p",{children:t.text})]})})}});function z(){return i.jsxs(R,{children:[i.jsx("h1",{children:"Auto Focus when Scrolling"}),i.jsx(p.Status,{}),i.jsxs("div",{style:{width:"100%",display:"flex",gap:20,height:300,border:"1px solid gray"},children:[i.jsx(p.Items,{}),i.jsx(p.FocusItem,{})]})]})}export{z as default};
