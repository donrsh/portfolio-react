import{R as b,r as u,j as n}from"./jsx-runtime-JVR6BLX4.js";import{c as K}from"./createSub-CFYt2xaS.js";import{c as C,u as F}from"./with-selector-DyLZNxmq.js";import{u as k}from"./useHorizontalScroll-CzhzS8ks.js";const{useDebugValue:M}=b,{useSyncExternalStoreWithSelector:V}=F,z=e=>e;function O(e,t=z,r){const s=V(e.subscribe,e.getState,e.getServerState||e.getInitialState,t,r);return M(s),s}const E=(e,t)=>{const r=C(e),s=(a,o=t)=>O(r,a,o);return Object.assign(s,r),s},D=(e,t)=>e?E(e,t):E;function R(e,t){if(Object.is(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;if(e instanceof Map&&t instanceof Map){if(e.size!==t.size)return!1;for(const[s,a]of e)if(!Object.is(a,t.get(s)))return!1;return!0}if(e instanceof Set&&t instanceof Set){if(e.size!==t.size)return!1;for(const s of e)if(!t.has(s))return!1;return!0}const r=Object.keys(e);if(r.length!==Object.keys(t).length)return!1;for(const s of r)if(!Object.prototype.hasOwnProperty.call(t,s)||!Object.is(e[s],t[s]))return!1;return!0}const w="data-auto-focus-item-when-scrolling",S=u.createContext(null),v=()=>u.useContext(S),y=(...e)=>v()(...e),q=e=>D((r,s,a)=>({set:r,scrollContainer:null,scrollContainerRef(o){r({scrollContainer:o})},scrollContainerObserver:null,scrollingDirection:null,itemElKeyMap:new WeakMap,inViewItemEls:new Set,inViewItemKeys:new Set,setInViewItemEls(o,i){const{inViewItemEls:l,itemElKeyMap:f}=s();o.forEach(m=>l.add(m)),i.forEach(m=>l.delete(m));const d=new Set(l),c=new Set([...d].map(m=>f.get(m)??null));c.delete(null),r({inViewItemEls:new Set(l),inViewItemKeys:c})},focusItemEl:null,focusItemKey:null,updateFocus(){const{inViewItemEls:o,scrollContainer:i,scrollingDirection:l,focusItemEl:f,itemElKeyMap:d}=s();if(o.has(f))return;let c=[...(i==null?void 0:i.querySelectorAll(`[${w}]`))??[]];l==="backward"&&c.reverse();const m=c.find(h=>o.has(h))??null,g=d.get(m)??null;r({focusItemEl:m,focusItemKey:g})},useItem(o){const i=u.useRef(),[l,f,d,c]=v()(h=>[h.focusItemEl,h.set,h.scrollContainerObserver,h.itemElKeyMap]);u.useEffect(()=>{i.current&&d&&(i.current.setAttribute(w,""),d==null||d.observe(i.current))},[d]),u.useEffect(()=>{if(!["string","number"].includes(typeof o)){console.error("[useItem] item key should be string or number. Please check.");return}i.current&&c.set(i.current,o)},[o]);const m=l===i.current,g=u.useCallback(()=>{f({focusItemEl:i.current,focusItemKey:o})},[f]);return u.useMemo(()=>({ref:i,isFocus:m,focus:g}),[i,m])}}),R),W=({children:e,scrollerDirection:t})=>{const[r]=u.useState(()=>q()),[s,a,o,i]=r(l=>[l.scrollContainer,l.setInViewItemEls,l.updateFocus,l.set]);return u.useEffect(()=>{if(!s)return;const l=new IntersectionObserver((f,d)=>{a(f.filter(c=>c.isIntersecting).map(c=>c.target),f.filter(c=>!c.isIntersecting).map(c=>c.target))},{root:s,threshold:1});return i({scrollContainerObserver:l}),()=>{l.disconnect()}},[s,a,i]),u.useEffect(()=>{if(!s)return;const l=f=>{const c=(t==="horizontal"?-f.deltaX:f.deltaY)>=0?"forward":"backward";i({scrollingDirection:c}),o()};return s.addEventListener("wheel",l),()=>s.removeEventListener("wheel",l)},[s,i,o,t]),n.jsx(S.Provider,{value:r,children:e})},j=e=>({id:e,title:`Item ${e+1}`,text:[e%4>=0&&"Lorem ipsum dolor sit amet consectetur adipisicing elit.",e%4>=1&&"Minus quidem,",e%4>=2&&"reprehenderit aliquid iure esse quibusdam perspiciatis modi doloremque nobis at voluptatem repellat dignissimos nihil enim aspernatur eos?",e%4>=3&&"Fuga, accusantium incidunt."].filter(Boolean).join(" ")});let p=new Array(20).fill(null).map((e,t)=>j(t));const x=e=>p.find(t=>t.id===e)??null,P=(...e)=>u.useMemo(()=>t=>{e.forEach(r=>{typeof r=="function"&&r(t),typeof r=="object"&&r!==null&&(r.current=t)})},[e]),I=K({Status:()=>{const[e,t,r]=y(o=>[o.scrollingDirection,o.inViewItemKeys,o.focusItemKey]),s=u.useMemo(()=>t?[...t].map(x):[],[t]),a=u.useMemo(()=>x(r),[r]);return n.jsxs("div",{style:{marginBottom:20},children:[n.jsxs("code",{children:[n.jsx("b",{children:"scrolling direction"}),": ",n.jsx("code",{children:e})]}),n.jsx("br",{}),n.jsxs("code",{children:[n.jsx("b",{children:"items in view"}),": ",s.map(o=>o==null?void 0:o.title).join(", ")]}),n.jsx("br",{}),n.jsxs("code",{children:[n.jsx("b",{children:"focus item"}),": ",a==null?void 0:a.title]})]})},Item:({id:e,title:t,text:r})=>{const{ref:s,isFocus:a,focus:o}=y(i=>i.useItem(e));return n.jsx("div",{ref:s,style:{borderBottom:"1px solid gray",paddingInline:8,cursor:"pointer",width:"100px",flexShrink:0},onClick:o,children:n.jsx("div",{style:{opacity:a?1:.4},children:n.jsx("p",{children:n.jsx("b",{children:t})})})})},Items:({scrollerDirection:e})=>{const t=y(i=>i.scrollContainerRef),r=k(),[,s]=u.useReducer(i=>i+1,0),a=P(t,e==="horizontal"?r:null),o=u.useCallback(()=>{p[p.length]=j(p.length),s()},[]);return n.jsxs("div",{ref:a,style:{height:e==="vertical"?"100%":"fit-content",background:"lightgray",overflow:"auto",flex:"none",display:"flex",flexDirection:e==="horizontal"?"row":"column"},children:[p.map(i=>n.jsx(I.Item,{...i},i.id)),n.jsx("div",{style:{position:"sticky",[e==="horizontal"?"right":"bottom"]:0},children:n.jsx("button",{style:{width:100},onClick:o,children:"Add an item"})}),n.jsx("div",{style:{height:"100%"}})]})},FocusItem:()=>{const e=y(r=>r.focusItemKey),t=u.useMemo(()=>x(e),[e]);return t&&n.jsx("div",{children:n.jsxs("div",{children:[n.jsx("p",{children:n.jsx("b",{children:t.title})}),n.jsx("p",{children:t.text})]})})}});function Y(){const[e,t]=u.useState("vertical");return n.jsxs(n.Fragment,{children:[n.jsx("h1",{children:"Auto Focus when Scrolling"}),n.jsxs("div",{children:[n.jsx("b",{children:"Scroller Direction"}),["vertical","horizontal"].map(r=>n.jsxs("label",{children:[n.jsx("input",{type:"radio",name:"scrollerDirection",value:r,onChange:()=>t(r),checked:e===r}),r]},r))]}),n.jsx("hr",{}),n.jsxs(W,{scrollerDirection:e,children:[n.jsx(I.Status,{}),n.jsxs("div",{style:{width:"100%",display:"flex",flexDirection:e==="horizontal"?"column":"row",gap:20,height:300,border:"1px solid gray"},children:[n.jsx(I.Items,{scrollerDirection:e}),n.jsx(I.FocusItem,{})]})]},e)]})}export{Y as default};
